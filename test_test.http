### Profile Image API Test File
### API Endpoint: http://localhost:8081/api/v1/profile/image

@baseUrl = http://localhost:8081/api/v1
@token = eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InRlc3R1c2VyQGV4YW1wbGUuY29tIiwic3ViIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJpYXQiOjE3NjE2NjkzODIsImV4cCI6MTc2MTcxMjU4Mn0.cx1fMjNvA9H_HEJXOKkYeIpCsAEl11z4mtsLi05qWK4

# ===================================================================
# PROFILE IMAGE API TESTS
# ===================================================================

### 1. Update Profile Image (PUT method - Expected: 501 - N/A)
PUT {{baseUrl}}/profile/image
Authorization: Bearer {{token}}

### 2. Update Profile Image with JSON Content-Type
PUT {{baseUrl}}/profile/image
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "imageUrl": "https://example.com/profile-image.jpg"
}

### 3. Update Profile Image with Form Data (Correct Format)
PUT {{baseUrl}}/profile/image
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Authorization: Bearer {{token}}

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="profile.png"
Content-Type: image/png

< ./profile.png
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 3a. Update Profile Image with Different Form Field Name
PUT {{baseUrl}}/profile/image
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Authorization: Bearer {{token}}

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="profileImage"; filename="profile.png"
Content-Type: image/png

< ./profile.png
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 3b. Update Profile Image with Base64 PNG Data
PUT {{baseUrl}}/profile/image
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "file": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="
}

### 4. Update Profile Image without Authorization (Expected: 403 - Forbidden)
PUT {{baseUrl}}/profile/image

### 5. Update Profile Image with Invalid Token (Expected: 401 - Unauthorized)
PUT {{baseUrl}}/profile/image
Authorization: Bearer invalid.token.here

### 6. Update Profile Image with Expired Token Pattern
PUT {{baseUrl}}/profile/image
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2MDAwMDAwMDB9.invalid

### 7. Test GET method (Expected: 405 - Method Not Allowed)
GET {{baseUrl}}/profile/image
Authorization: Bearer {{token}}

### 8. Test POST method (Expected: 405 - Method Not Allowed)
POST {{baseUrl}}/profile/image
Authorization: Bearer {{token}}

### 9. Test DELETE method (Expected: 405 - Method Not Allowed)
DELETE {{baseUrl}}/profile/image
Authorization: Bearer {{token}}

### 10. Update Profile Image with Base64 Image Data
PUT {{baseUrl}}/profile/image
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "imageData": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k="
}

### 11. Test with Empty File (Expected: 400 - File tidak boleh kosong)
PUT {{baseUrl}}/profile/image
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Authorization: Bearer {{token}}

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="empty.png"
Content-Type: image/png


------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 12. Test with Missing File Field (Expected: 400 - File tidak boleh kosong)
PUT {{baseUrl}}/profile/image
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Authorization: Bearer {{token}}

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="otherField"; filename="profile.png"
Content-Type: image/png

< ./profile.png
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 13. Test Using curl Command (Alternative method)
### Execute in terminal:
### curl -X PUT http://localhost:8081/api/v1/profile/image \
###   -H "Authorization: Bearer YOUR_TOKEN_HERE" \
###   -F "file=@profile.png"

### 13a. curl with different field name "image":
### curl -X PUT http://localhost:8081/api/v1/profile/image \
###   -H "Authorization: Bearer YOUR_TOKEN_HERE" \
###   -F "image=@profile.png"

### 13b. curl with field name "profileImage":
### curl -X PUT http://localhost:8081/api/v1/profile/image \
###   -H "Authorization: Bearer YOUR_TOKEN_HERE" \
###   -F "profileImage=@profile.png"

### 13c. POST method instead of PUT:
### curl -X POST http://localhost:8081/api/v1/profile/image \
###   -H "Authorization: Bearer YOUR_TOKEN_HERE" \
###   -F "file=@profile.png"

### 14. Test with Binary File Upload (REST Client compatible)
PUT {{baseUrl}}/profile/image
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=boundary

--boundary
Content-Disposition: form-data; name="file"; filename="test.png"
Content-Type: image/png

{{binary_data}}
--boundary--

### 15. POST method alternative (if PUT doesn't work)
POST {{baseUrl}}/profile/image
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="profile.png"
Content-Type: image/png

< ./profile.png
------WebKitFormBoundary7MA4YWxkTrZu0gW--

# ===================================================================
# EXPECTED RESPONSES
# ===================================================================

### Expected Response for PUT /profile image (Status 102 - Validation Error):
# {
#   "status": 102,
#   "message": "File tidak boleh kosong",
#   "data": null
# }

### Expected Response for Successful Upload (Status 200):
# {
#   "status": 0,
#   "message": "Update profile image success",
#   "data": {
#     "profileImage": "https://example.com/uploads/profile/image.jpg"
#   }
# }

### Expected Response for Missing Token (Status 403):
# {
#   "timestamp": "2025-10-29T10:00:00.000+00:00",
#   "status": 403,
#   "error": "Forbidden",
#   "path": "/api/v1/profile/image"
# }

### Expected Response for Invalid Token (Status 401):
# {
#   "status": 108,
#   "message": "Token tidak tidak valid atau kadaluwarsa",
#   "data": null
# }

### Expected Response for Method Not Allowed (Status 405):
# {
#   "timestamp": "2025-10-29T10:00:00.000+00:00",
#   "status": 405,
#   "error": "Method Not Allowed",
#   "path": "/api/v1/profile/image"
# }

# ===================================================================
# INSTRUCTIONS & TROUBLESHOOTING
# ===================================================================

# 1. Make sure the application is running on http://localhost:8081
# 2. Update @token variable with a valid JWT token from login endpoint
# 3. Execute tests to verify profile image API behavior
#
# TROUBLESHOOTING "File tidak boleh kosong" ERROR:
# ------------------------------------------------
# The error indicates the server is not receiving the file properly. Try these solutions:
#
# 1. USE DIFFERENT FIELD NAMES:
#    - "file" (most common)
#    - "image"
#    - "profileImage"
#    - "profile_image"
#
# 2. TRY DIFFERENT HTTP METHODS:
#    - PUT (current)
#    - POST (alternative)
#
# 3. USE curl COMMAND INSTEAD:
#    curl -X PUT http://localhost:8081/api/v1/profile/image \
#      -H "Authorization: Bearer YOUR_TOKEN_HERE" \
#      -F "file=@/path/to/your/image.png"
#
# 4. ENSURE FILE EXISTS:
#    - Place a PNG file named "profile.png" in the same directory as this .http file
#    - Update the file path in the test requests if needed
#
# 5. CHECK CONTENT-TYPE HEADERS:
#    - Ensure multipart/form-data is properly formatted
#    - Verify boundary strings are correct
#
# 6. VERIFY FILE SIZE LIMITS:
#    - Check if there are file size restrictions
#    - Try with a smaller image file (< 1MB)
#
# TEST RECOMMENDATIONS:
# ------------------------------------------------
# - Start with test #3 (file field name)
# - Try test #3a (profileImage field name)
# - If still failing, use the curl command in test #13
# - Check server logs for detailed error information
#
# WORKING SOLUTIONS FOUND:
# - The endpoint accepts file uploads with status 102 validation error
# - Server expects multipart/form-data with proper file field
#
# SWAGGER UI TESTING INSTRUCTIONS:
# ------------------------------------------------
# 1. Buka Swagger UI: http://localhost:8081/swagger-ui/index.html
# 2. Cari endpoint "PUT /api/v1/profile/image"
# 3. Klik untuk expand endpoint
# 4. Klik "Try it out" button
# 5. Parameter setup:
#    - Parameter type: file (multipart/form-data)
#    - Field name: coba "file", "image", atau "profileImage"
#    - Choose file: pilih file PNG Anda
# 6. Klik "Execute" untuk testing
#
# ALTERNATIVE: Use curl commands from tests #13, #13a, #13b, #13c
#
# IMPORTANT: Get valid token first from login endpoint before testing!